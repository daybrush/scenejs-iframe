{"version":3,"file":"iframe.cjs.js","sources":["../src/utils.ts","../src/IframeItem.ts"],"sourcesContent":["import { Animator } from \"scenejs\";\nimport { addEvent, isString } from \"@daybrush/utils\";\n\naddEvent(window, \"message\", e => {\n    const result = parseMessage(e.data);\n\n    if (!result) {\n        return;\n    }\n\n    if (result[0] === \"ready\") {\n        sendMessage(e.source, \"end\");\n    }\n});\n\nexport function sendMessage(target: any, message: string) {\n    target.postMessage(`scene:${message}`, \"*\");\n}\nexport function parseMessage(message: string) {\n    if (!isString(message)) {\n        return;\n    }\n    return /(?<=^scene\\:)([^:]+)(?:\\:([^:]+))*/g.exec(message);\n}\n\n/**\n * Register an animator to be controlled by the parent.\n * @memberof IframeItem\n * @param - The target to register\n * @example\nimport Scene from \"scenejs\";\nimport { register } from \"@scenejs/iframe\";\nvar scene = new Scene({\n    ....\n});\n// IframeItem.register(scene);\nregister(scene);\n */\nexport function register(item: Animator): void {\n    if (\n        window.parent\n        && window !== window.parent\n        && window.parent.postMessage\n    ) {\n        sendMessage(window.parent, \"ready\");\n    }\n    addEvent(window, \"message\", e => {\n        const data = e.data;\n        const result = parseMessage(data);\n\n        if (!result) {\n            return;\n        }\n        const type = result[1];\n        const value = result[2];\n\n        switch (type) {\n            case \"start\":\n                item.start(0);\n                break;\n            case \"pause\":\n                item.pause();\n                break;\n            case \"end\":\n                item.finish();\n                break;\n            case \"time\":\n            case \"animate\":\n                item.setTime(parseFloat(value), type === \"animate\", true);\n                break;\n        }\n    });\n}\n","import { SceneItem, EasingType } from \"scenejs\";\nimport { sendMessage } from \"./utils\";\n\n/**\n * Control the animation of iframe\n * @sort 1\n * @param {any} properties - properties\n * @param {SceneItemOptions} options - options\n * @example\n// index.html (parent)\nimport Scene from \"scenejs\";\nimport IframeItem from \"@scenejs/iframe\";\n\nvar scene = new Scene({\n    \"#iframe1\": new IframeItem({}, { duration: 3.4, delay: 0 }),\n    \"#iframe2\": new IframeItem({}, { duration: 3.4, delay: 0.15 }),\n    \"#iframe3\": new IframeItem({}, { duration: 3.4, delay: 0.3 }),\n    \"#iframe4\": new IframeItem({}, { duration: 3.4, delay: 0.45 }),\n}, {\n    selector: true,\n    iterationCount: \"infinite\",\n});\n */\nclass IframeItem extends SceneItem {\n    public setTime(time: number | string, isTick?: boolean, isParent?: boolean, parentEasing?: EasingType): this {\n        super.setTime(time, isTick, isParent, parentEasing);\n        const iterationTime = this.getIterationTime();\n\n        this.sendMessage(`${isTick ? \"animate\" : \"time\"}:${iterationTime}`);\n        return this;\n    }\n    public end(): this {\n        super.end();\n        this.sendMessage(\"end\");\n        return this;\n    }\n    public pause(): this {\n        super.pause();\n        this.sendMessage(\"pause\");\n        return this;\n    }\n    public start(delay?: number): boolean {\n        const result = super.start(delay);\n\n        this.sendMessage(\"start\");\n        return result;\n    }\n    private sendMessage(message: string) {\n        const elements = this.getElements() as HTMLIFrameElement[];\n\n        elements.forEach(el => {\n            if (!el.contentWindow) {\n                return;\n            }\n            sendMessage(el.contentWindow, message);\n        });\n\n    }\n}\nexport default IframeItem;\n"],"names":["addEvent","window","e","result","parseMessage","data","sendMessage","source","target","message","postMessage","isString","exec","register","item","parent","type","value","start","pause","finish","setTime","parseFloat","tslib_1","time","isTick","isParent","parentEasing","_super","iterationTime","getIterationTime","end","delay","elements","getElements","forEach","el","contentWindow","SceneItem"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGAA,cAAQ,CAACC,MAAD,EAAS,SAAT,EAAoB,UAAAC,CAAA;MAClBC,MAAM,GAAGC,YAAY,CAACF,CAAC,CAACG,IAAH,CAA3B;;MAEI,CAACF,MAAL,EAAa;;;;MAITA,MAAM,CAAC,CAAD,CAAN,KAAc,OAAlB,EAA2B;IACvBG,WAAW,CAACJ,CAAC,CAACK,MAAH,EAAW,KAAX,CAAX;;CARA,CAAR;AAYA,SAAgBD,YAAYE,QAAaC;EACrCD,MAAM,CAACE,WAAP,CAAmB,WAASD,OAA5B,EAAuC,GAAvC;;AAEJ,SAAgBL,aAAaK;MACrB,CAACE,cAAQ,CAACF,OAAD,CAAb,EAAwB;;;;SAGjB,sCAAsCG,IAAtC,CAA2CH,OAA3C,CAAP;;;;;;;;;;;;;;;;AAgBJ,SAAgBI,SAASC;MAEjBb,MAAM,CAACc,MAAP,IACGd,MAAM,KAAKA,MAAM,CAACc,MADrB,IAEGd,MAAM,CAACc,MAAP,CAAcL,WAHrB,EAIE;IACEJ,WAAW,CAACL,MAAM,CAACc,MAAR,EAAgB,OAAhB,CAAX;;;EAEJf,cAAQ,CAACC,MAAD,EAAS,SAAT,EAAoB,UAAAC,CAAA;QAClBG,IAAI,GAAGH,CAAC,CAACG,IAAf;QACMF,MAAM,GAAGC,YAAY,CAACC,IAAD,CAA3B;;QAEI,CAACF,MAAL,EAAa;;;;QAGPa,IAAI,GAAGb,MAAM,CAAC,CAAD,CAAnB;QACMc,KAAK,GAAGd,MAAM,CAAC,CAAD,CAApB;;YAEQa,IAAR;WACS,OAAL;QACIF,IAAI,CAACI,KAAL,CAAW,CAAX;;;WAEC,OAAL;QACIJ,IAAI,CAACK,KAAL;;;WAEC,KAAL;QACIL,IAAI,CAACM,MAAL;;;WAEC,MAAL;WACK,SAAL;QACIN,IAAI,CAACO,OAAL,CAAaC,UAAU,CAACL,KAAD,CAAvB,EAAgCD,IAAI,KAAK,SAAzC,EAAoD,IAApD;;;GAtBJ,CAAR;;;AC3CJ;;;;;;;;;;;;;;;;;;;;;AAoBA;;;EAAyBO,SAAA,WAAA,QAAA;;qBAAzB;;;;;;iBACW,GAAP,UAAeC,IAAf,EAAsCC,MAAtC,EAAwDC,QAAxD,EAA4EC,YAA5E;IACIC,gBAAA,CAAMP,OAAN,KAAA,KAAA,EAAcG,IAAd,EAAoBC,MAApB,EAA4BC,QAA5B,EAAsCC,YAAtC;;QACME,aAAa,GAAG,KAAKC,gBAAL,EAAtB;SAEKxB,WAAL,CAAiB,CAAGmB,MAAM,GAAG,SAAH,GAAe,MAAxB,OAAA,GAAkCI,aAAnD;WACO,IAAP;GALG;;aAOA,GAAP;IACID,gBAAA,CAAMG,GAAN,KAAA,KAAA;;SACKzB,WAAL,CAAiB,KAAjB;WACO,IAAP;GAHG;;eAKA,GAAP;IACIsB,gBAAA,CAAMT,KAAN,KAAA,KAAA;;SACKb,WAAL,CAAiB,OAAjB;WACO,IAAP;GAHG;;eAKA,GAAP,UAAa0B,KAAb;QACU7B,MAAM,GAAGyB,gBAAA,CAAMV,KAAN,KAAA,KAAA,EAAYc,KAAZ,CAAf;;SAEK1B,WAAL,CAAiB,OAAjB;WACOH,MAAP;GAJG;;qBAMC,GAAR,UAAoBM,OAApB;QACUwB,QAAQ,GAAG,KAAKC,WAAL,EAAjB;IAEAD,QAAQ,CAACE,OAAT,CAAiB,UAAAC,EAAA;UACT,CAACA,EAAE,CAACC,aAAR,EAAuB;;;;MAGvB/B,WAAW,CAAC8B,EAAE,CAACC,aAAJ,EAAmB5B,OAAnB,CAAX;KAJJ;GAHI;;mBAWZ;EAnCyB6B,kBAAzB;;;;;"}